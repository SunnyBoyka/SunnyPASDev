/*
drop table public.nmap_commands;
drop table public.scan_data;
drop table public.users;
*/
CREATE TABLE IF NOT EXISTS public.users
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    name character varying(255) COLLATE pg_catalog."default",
    mail character varying(255) COLLATE pg_catalog."default",
    pwd character varying(1000) COLLATE pg_catalog."default",
    is_default integer DEFAULT 1,
    sid character varying(124) COLLATE pg_catalog."default",
    login_status integer DEFAULT 0,
    roles character varying(1000) COLLATE pg_catalog."default",
    ins_upd_time timestamp without time zone DEFAULT now(),
    CONSTRAINT id_pk PRIMARY KEY (id)
);


insert into users values(1,'Admin','admin','123','1','',0,'admin',CURRENT_TIMESTAMP);



CREATE TABLE IF NOT EXISTS public.nmap_commands
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    commandname character varying(255),
    description character varying(1024),
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by integer,
    updated_by integer,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,	
    CONSTRAINT nmapid_pk PRIMARY KEY (id)
);

insert into nmap_commands values (1,'nmap -sV ','Nmap command to detect service versions',
CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1,1,TRUE);

insert into nmap_commands values (2,'nmap -O ','Nmap command to detect operating system running in the target machine',
CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1,1,TRUE);

insert into nmap_commands values (3,'nmap -A ','Nmap command for an aggressive scan (including OS detection)',
CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1,1,TRUE);

insert into nmap_commands values (4,'nmap -sC ','Nmap command to that performs a script scan using the default set of scripts.',
CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1,1,TRUE);






CREATE TABLE IF NOT EXISTS public.scan_data
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    scan_type character varying(255) COLLATE pg_catalog."default",
    command character varying(1000) COLLATE pg_catalog."default",
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMPTZ NULL,
    created_by integer,
    updated_by integer,
    scan_status character(50)  NOT NULL DEFAULT 'Pending',
    scan_result text NULL,
    triggered_by integer,
	CONSTRAINT fk_triggered_by FOREIGN KEY (triggered_by)
	REFERENCES users(id) ON DELETE SET NULL
);
